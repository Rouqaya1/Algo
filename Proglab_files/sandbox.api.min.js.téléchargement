var Sandbox=function(){"use strict";function detectGenerators(){try{eval("(function *(){})")}catch(e){return!1}return!0}function prepareSource(e,t,r,n){if(e){t&&addDebugInfo(e,n),estraverse.traverse(e,{enter:function(e){("ForStatement"===e.type||"WhileStatement"===e.type||"DoWhileStatement"===e.type)&&("BlockStatement"!==e.body.type&&(e.body={type:"BlockStatement",body:[e.body]}),e.body.body.push(JSON.parse(jsonLoopCheck)))}}),r&&estraverse.replace(e,{leave:function(e){if("CallExpression"===e.type&&"MemberExpression"===e.callee.type){var t=e.callee.object;if("Identifier"===t.type&&"proglab"===t.name&&"Identifier"===e.callee.property.type){var r=e.callee.property.name;if("input"===r||"inputNumber"===r||"pause"===r)return{type:"YieldExpression",argument:e}}}return e}});var a=escodegen.generate(e,{format:{compact:!0}});return a=r?'flowControl(function *(){"use strict";'+a+"signalEndOfProgram();})();":'(function(){"use strict";var f=function(){'+a+"};try{f();}catch(e){if (!(e instanceof EmergencyStopError)) throw e;}finally{signalEndOfProgram();}}());"}}function sendMessage(e){sandboxWindow.postMessage(JSON.stringify(e),targetOrigin)}function receiveMessage(e){if(!e||e.origin!==targetOrigin&&"*"!==targetOrigin||!e.data)return void console.log("Invalid Iframe message received");var t="string"==typeof e.data?JSON.parse(e.data):e.data;switch(t.type){case"end":runCallback&&runCallback(t.type,t.value,t.output)}}function shouldWatch(e,t){if(!t)return!0;var r=e.type;if("Identifier"===r)return t[e.name];if("MemberExpression"===r){var n=e.object;if("Identifier"===n.type)return t[n.name]}return!0}function addDebugInfo(e,t){estraverse.replace(e,{enter:function(e){if("FunctionDeclaration"===e.type||"FunctionExpression"===e.type)return estraverse.VisitorOption.Skip;if(!e.logged){if("VariableDeclarator"===e.type){if(!shouldWatch(e.id,t))return e;if(!e.loc)return e;var r={type:"Literal",value:e.id.name},n={type:"Literal",value:e.loc.start.line},a=[n,r];return e.init&&a.push(e.init),e.init=callExpression("logDeclaration",a),e}if("AssignmentExpression"===e.type)return shouldWatch(e.left,t)?makeDebugCall(e,e.left,"logAssignment","logPropertyAssignment"):e;if("CallExpression"===e.type&&"ALGOBOX_INIT_LISTE"===e.callee.name){var i=[{type:"Literal",value:e.loc.start.line},{type:"Literal",value:e.arguments[0].name}].concat(e.arguments);return callExpression("ALGOBOX_INIT_LISTE",i)}if("UpdateExpression"===e.type){if(!shouldWatch(e.argument,t))return e;if(e.prefix)return makeDebugCall(e,e.argument,"logAssignment","logPropertyAssignment");if("++"===e.operator)return makeDebugCall(e,e.argument,"logPostIncrement","logPropertyPostIncrement");if("--"===e.operator)return makeDebugCall(e,e.argument,"logPostDecrement","logPropertyPostDecrement")}}}})}function shallowCopy(e){var t={};for(var r in e)t[r]=e[r];return t}function makeDebugCall(e,t,r,n){var a,i=[];if("Identifier"===t.type)a=r,i[1]={type:"Literal",value:t.name};else{if("MemberExpression"!==t.type||!t.computed||"Identifier"!==t.object.type)return;a=n,i[1]=shallowCopy(t.property),i[3]={type:"Literal",value:t.object.name},i[4]={type:"Identifier",name:t.object.name}}return e.logged=!0,e.loc?(i[0]={type:"Literal",value:e.loc.start.line},i[2]=e,callExpression(a,i)):e}function callExpression(e,t){return{type:"CallExpression",callee:{type:"MemberExpression",object:{type:"Identifier",name:"Debug"},property:{type:"Identifier",name:e}},arguments:t}}function next(){if(!currentScript&&0!==queue.length){currentScript=queue.shift(),runCallback=endOfScript;var e=currentScript.data,t=hasGenerators&&e.useGenerators!==!1,r=prepareSource(e.jsAst,e.debugMode,t,e.watchvars);sendMessage({command:"exec",script:r,captureOutput:e.captureOutput,allowTimers:e.allowTimers,debugMode:e.debugMode,input:e.input,language:e.language,watchvars:e.watchvars,useGenerators:t})}}function endOfScript(e,t,r){currentScript.callback&&currentScript.callback(e,t,r),currentScript=null,next()}var execOptions,runCallback,hasGenerators=detectGenerators(),jsonLoopCheck='{"type":"ExpressionStatement","expression":{"type":"LogicalExpression","left":{"type":"UpdateExpression","operator":"--","prefix":true,"argument":{"type":"Identifier","name":"__totalLoopCounter__"}},"operator":"||","right":{"type":"CallExpression","callee":{"type":"Identifier","name":"confirmBigLoop"},"arguments":[]}}}',http="file:"!==location.protocol,sandboxWindow,targetOrigin;window.addEventListener("message",receiveMessage,!1);var queue=[],currentScript;return{setIframe:function(e){if(http){var t=document.getElementById(e);sandboxWindow=t.contentWindow,targetOrigin=t.getAttribute("src").replace(/[?#].*$/,"").replace(/\/$/,"")}else targetOrigin="*"},run:function(e,t){queue.push({data:e,callback:t}),next()},stop:function(){sendMessage({command:"stop"})},require:function(e){sendMessage({command:"require",lib:e})},test:function(){try{{null!==sandboxWindow.document}return!0}catch(e){return!1}}}}();